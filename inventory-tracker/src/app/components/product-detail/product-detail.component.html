<div class="detail-container">
  <div class="back-nav">
    <button mat-button routerLink="/">
      <mat-icon>arrow_back</mat-icon>
      Back to Dashboard
    </button>
  </div>
  
  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading product...</p>
    </div>
  } @else if (product()) {
    <div class="product-detail">
      <mat-card class="main-card">
        <div class="product-header">
          <div class="product-image">
            @if (product()?.imageUrl) {
              <img [src]="product()?.imageUrl" [alt]="product()?.name">
            } @else {
              <mat-icon>inventory_2</mat-icon>
            }
          </div>
          
          <div class="product-info">
            <div class="product-title-row">
              <h1>{{ product()?.name }}</h1>
              <mat-chip [class]="getStockStatusClass()">
                {{ getStockStatus() }}
              </mat-chip>
            </div>
            
            <p class="sku">SKU: {{ product()?.sku }}</p>
            <p class="category">
              <mat-icon>category</mat-icon>
              {{ product()?.category }}
            </p>
            
            @if (product()?.description) {
              <p class="description">{{ product()?.description }}</p>
            }
          </div>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <mat-icon>attach_money</mat-icon>
            <div class="stat-content">
              <span class="stat-value">${{ product()?.price?.toFixed(2) }}</span>
              <span class="stat-label">Price</span>
            </div>
          </div>
          
          <div class="stat-card">
            <mat-icon>inventory</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ product()?.quantity }}</span>
              <span class="stat-label">In Stock</span>
            </div>
          </div>
          
          <div class="stat-card">
            <mat-icon>warning</mat-icon>
            <div class="stat-content">
              <span class="stat-value">{{ product()?.minStock }}</span>
              <span class="stat-label">Min Stock</span>
            </div>
          </div>
          
          <div class="stat-card">
            <mat-icon>calculate</mat-icon>
            <div class="stat-content">
              <span class="stat-value">${{ getTotalValue() }}</span>
              <span class="stat-label">Total Value</span>
            </div>
          </div>
        </div>
        
        <div class="actions">
          <button mat-raised-button color="primary" (click)="editProduct()">
            <mat-icon>edit</mat-icon>
            Edit Product
          </button>
          <button mat-raised-button color="warn" (click)="deleteProduct()">
            <mat-icon>delete</mat-icon>
            Delete
          </button>
        </div>
      </mat-card>
      
      <mat-card class="history-card">
        <h2>
          <mat-icon>history</mat-icon>
          Stock History
        </h2>
        
        @if (history().length > 0) {
          <table mat-table [dataSource]="history()" class="history-table">
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let entry">
                {{ (entry.timestamp || entry.date) | date:'short' }}
              </td>
            </ng-container>
            
            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef>Type</th>
              <td mat-cell *matCellDef="let entry">
                <mat-chip [class]="entry.changeType || entry.type">
                  {{ entry.changeType || entry.type }}
                </mat-chip>
              </td>
            </ng-container>
            
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef>Quantity</th>
              <td mat-cell *matCellDef="let entry" [class.positive]="getQuantityChange(entry) > 0" [class.negative]="getQuantityChange(entry) < 0">
                {{ getQuantityChange(entry) > 0 ? '+' : '' }}{{ getQuantityChange(entry) }}
              </td>
            </ng-container>
            
            <ng-container matColumnDef="reason">
              <th mat-header-cell *matHeaderCellDef>Reason</th>
              <td mat-cell *matCellDef="let entry">{{ entry.notes || entry.reason || '-' }}</td>
            </ng-container>
            
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        } @else {
          <div class="no-history">
            <mat-icon>info</mat-icon>
            <p>No stock history available for this product</p>
          </div>
        }
      </mat-card>
    </div>
  } @else {
    <div class="not-found">
      <mat-icon>search_off</mat-icon>
      <h2>Product Not Found</h2>
      <p>The product you're looking for doesn't exist or has been removed.</p>
      <button mat-raised-button color="primary" routerLink="/">
        Return to Dashboard
      </button>
    </div>
  }
</div>
